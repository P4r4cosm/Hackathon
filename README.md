# Архитектура проекта
![Архитектура проекта](photos\architecture.png)

# Пример работы
![Интерфейс1](photo/1.png)
![Интерфейс2](photos\2.jpg)
![Интерфейс3](photos\3.jpg)
![Интерфейс4](photos\4.jpg)
![Интерфейс5](photos\5.jpg)

https://github.com/P4r4cosm/Hackathon/blob/master/photos/architecture.png

# Аудио примеры вы можете найти в директории example

# Описание Проекта

Проект построен на микросервисной архетиктуре для обработки аудио и предоставления пользовательского интерфейса.

## Структура Директорий

*   **`/whisper_worker`**: Python-сервис, который прослушивает очередь задач в RabbitMQ, выполняет распознавание речи на полученных аудиофайлах с помощью `openai-whisper` и отправляет результаты обратно в MinIO и RabbitMQ.
*   **`/whisperDocker`**: Содержит Docker-образ и исходный код модели `openai-whisper` для распознавания речи.
*   **`/HistoricalDenoiseWorker`**: Python-сервис, предназначенный для удаления шумов с исторических аудиозаписей. Использует модель U-Net.
*   **`/DemucsWorker`**: Python-сервис, предназначенный для разделения музыкальных треков на отдельные дорожки (вокал, ударные, бас, остальные) с использованием модели Demucs. В проекте испоьзуется для отделения вокала от всего остального.
*   **`/FrontendService`**: Фронтенд-приложение (`react`+`redux`), предоставляющее основной пользовательский интерфейс для взаимодействия с системой.
*   **`/historical-denoise`**: Содержит исходный код и Docker-окружение для модели "A two-stage U-Net for high-fidelity denoising of historical recordings". Используется `HistoricalDenoiseWorker`.
*   **`/music_test`**: Директория, для тестовых музыкальных файлов.
*   **`/data`**: Директория для хранения данных. Содержит `elasticsearch` и `postgres`.
*   **`/logs`**: Директория для хранения логов.
*   **`/demucs`**: Содержит Docker-окружение для [Demucs](https://github.com/adefossez/demucs) от Facebook, которое используется `DemucsWorker` для разделения музыкальных треков.
*   **`/SoundService`**: Бэкенд-сервис, написанный на .NET (C#), отвечающий за операции, связанные со звуковыми файлами (загрузка, обработка, управление).
*   **`/HackathonGateway`**: API Gateway, написанный на .NET (C#). Служит единой точкой входа для всех бэкенд-сервисов, маршрутизируя запросы к соответствующим микросервисам.
*   **`/AuthServiceFrontend`**: Отдельный фронтенд-сервис для аутентификации пользователей (вход и регистрация). Написан на vanilla HTML, CSS, JavaScript и использует Nginx в качестве веб-сервера.
*   **`/AuthService`**: Бэкенд-сервис авторизации, написанный на .NET (C#). Отвечает за регистрацию, аутентификацию пользователей и управление JWT токенами.

## Docker и Запуск

Проект использует Docker и Docker Compose для оркестрации всех сервисов.

*   **`docker-compose.yaml`**: Основной файл конфигурации Docker Compose. Определяет все сервисы, их сборку, порты, зависимости, переменные окружения и тома.
*   **`init-mc.sh`**: Скрипт для инициализации MinIO (клиент `mc`). Используется для создания бакетов и настройки политик доступа в объектном хранилище MinIO, которое используется сервисами для хранения аудиофайлов и результатов их обработки.
*   **`setup-elasticsearch.sh`**: Скрипт для настройки Elasticsearch, для создания индексов.
*   **`audio_records_mapping.json`**: JSON-файл, который, содержит маппинг для индексов Elasticsearch, связанных с аудиозаписями.

### Инструкции по запуску

1.  **Установите Docker и Docker Compose**: Убедитесь, что на вашей системе установлены и работают Docker и Docker Compose.
2.  **Склонируйте репозиторий**:
    ```bash
    git clone https://github.com/P4r4cosm/Hackathon.git
    cd https://github.com/P4r4cosm/Hackathon.git
    ```
3.  **Настройте переменные окружения**: В проекте, используется файл `.env` для хранения конфигурационных переменных (доступы к базам данных, RabbitMQ, MinIO и т.д.). НЕ УДАЛЯЙТЕ ЕГО.
4.  **Запуск всех сервисов**:
    ```bash
    docker-compose up -d --build
    ```
    Команда `--build` пересобирает образы, если в Dockerfile были изменения. Для обычного запуска достаточно `docker-compose up -d`.
5.  **Инициализация MinIO**: Перед первым запуском требуется дополнительно запустить контейнер `mc-init` для организации MiniIO.
6.  **Проверка логов**: После запуска проверьте логи контейнеров, чтобы убедиться, что все сервисы стартовали корректно:
    ```bash
    docker-compose logs -f # Показать логи всех сервисов
    docker-compose logs -f <имя_сервиса> # Показать логи конкретного сервиса
    ```
7.  **Доступ к сервисам**:
    *   **FrontendService**: Основной интерфейс пользователя, скорее всего, будет доступен по адресу типа `http://localhost:3000`.
    *   **AuthServiceFrontend**: Интерфейс аутентификации, вероятно, будет доступен по адресам `http://localhost:3010` и `https://localhost:3011` (если конфигурация Nginx не изменена).
    *   **MiniIO** будет доступен по адресам `http://localhost:9001`. Данные для входа -- `minio_root`, `minio_root`
    * **RabbitMQ** будет доступен по адресам `http://localhost:15672`. Данные для входа -- `user`, `password`

    * Для более подробной информации смотрите .env, мы всё указали.

### Остановка проекта

Для остановки всех сервисов:

```bash
docker-compose down
```

Для остановки и удаления томов:

```bash
docker-compose down -v
```

## Важные замечания

*   **Конфигурация GPU**: Для сервисов, использующих модели машинного обучения (`whisper_worker`, `DemucsWorker`, `HistoricalDenoiseWorker`), может потребоваться доступ к GPU для ускорения обработки. Убедитесь, что Docker и Docker Compose настроены для работы с NVIDIA GPU, если вы планируете использовать GPU. Соответствующие настройки `deploy.resources.reservations.devices` должны быть раскомментированы или добавлены в `docker-compose.yaml` для этих сервисов.
*   **Кэширование моделей**: Модели машинного обучения (Whisper b Demucs) занимают значительное место и требуют времени на загрузку при первом запуске.
*   **Зависимости между сервисами**: Некоторые сервисы зависят от других (например, воркеры от RabbitMQ и MinIO, фронтенд от бэкенд-сервисов). `docker-compose.yaml` обычно управляет порядком запуска с помощью директивы `depends_on`, но убедитесь, что все внешние зависимости (как базы данных, брокеры сообщений) запущены и доступны.

