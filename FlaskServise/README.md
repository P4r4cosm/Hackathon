# FlaskServise

Этот сервис представляет собой Flask-приложение, предназначенное для обработки аудиофайлов с целью выделения вокальной дорожки.

## Логика работы

1.  **Прием файла**: Сервис ожидает POST-запрос на эндпоинт `/process_song`. В теле запроса должен находиться аудиофайл (`.wav` или `.flac`) под ключом `file`.
2.  **Сохранение файла**: Полученный аудиофайл временно сохраняется в директорию `<корень_проекта_demucs>/input/`.
3.  **Обработка с помощью Demucs**:
    *   Сервис вызывает команду `make run track=<имя_файла> model=htdemucs_ft splittrack=vocals shifts=2 overlap=0.3` в директории `../demucs` (относительно расположения `app.py`).
    *   Предполагается, что `Demucs` — это инструмент для разделения источников звука, и в данном случае он используется для извлечения вокала (`splittrack=vocals`).
4.  **Отправка результата**:
    *   В случае успешной обработки, сервис ищет файл `vocals.wav` в директории `<корень_проекта_demucs>/output/htdemucs_ft/<имя_трека_без_расширения>/`.
    *   Найденный файл `vocals.wav` отправляется клиенту в качестве ответа.
5.  **Обработка ошибок**: Сервис обрабатывает различные сценарии ошибок, включая:
    *   Отсутствие файла в запросе.
    *   Недопустимый тип файла.
    *   Ошибки во время выполнения команды `Demucs`.
    *   Отсутствие ожидаемого файла `vocals.wav` после обработки.
6.  **Очистка**: Временный входной файл удаляется из директории `<корень_проекта_demucs>/input/` после завершения обработки (как успешной, так и неуспешной).
7.  **Запуск**: По умолчанию сервис запускается на `0.0.0.0:5000` в режиме отладки.

## Зависимости

Основные зависимости указаны в файле `requirements.txt`. Кроме того, для корректной работы сервиса необходима настроенная среда `Demucs` в директории, расположенной на один уровень выше директории `FlaskServise` и называющейся `demucs`.

## Эндпоинты

*   `POST /process_song`
    *   **Описание**: Загружает аудиофайл для выделения вокала.
    *   **Тело запроса**: `multipart/form-data` с полем `file`, содержащим аудиофайл (`.wav` или `.flac`).
    *   **Успешный ответ (200 OK)**: Файл `vocals.wav`.
    *   **Ошибки**:
        *   `400 Bad Request`: Если файл не предоставлен, не выбран или имеет недопустимое расширение.
        *   `500 Internal Server Error`: В случае ошибок при обработке файла с помощью `Demucs` или если файл с вокалом не найден после обработки. 